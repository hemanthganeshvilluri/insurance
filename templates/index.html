<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Insurance Charges Predictor</title>

  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background: #f7f9fc; }
    .card { max-width: 820px; margin: 36px auto; border-radius: 12px; }
    .result-box { font-size: 1.25rem; font-weight: 600; }
    .small-muted { font-size: .88rem; color: #6c757d; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title mb-1">Insurance Charges Predictor</h3>
        <p class="small-muted mb-4">Enter features and click <strong>Predict</strong>. Backend must expose <code>/predict</code> returning JSON <code>{"prediction": number}</code>.</p>

        <form id="predict-form" class="row g-3">
          <div class="col-md-4">
            <label for="age" class="form-label">Age</label>
            <input type="number" min="0" max="120" class="form-control" id="age" required value="19">
          </div>

          <div class="col-md-4">
            <label for="sex" class="form-label">Sex</label>
            <select id="sex" class="form-select" required>
              <option value="male">male</option>
              <option value="female">female</option>
            </select>
          </div>

          <div class="col-md-4">
            <label for="bmi" class="form-label">BMI</label>
            <input type="number" step="0.1" min="0" max="100" class="form-control" id="bmi" required value="27.9">
          </div>

          <div class="col-md-4">
            <label for="children" class="form-label">Children</label>
            <input type="number" min="0" max="10" class="form-control" id="children" required value="0">
          </div>

          <div class="col-md-4">
            <label for="smoker" class="form-label">Smoker</label>
            <select id="smoker" class="form-select" required>
              <option value="no">no</option>
              <option value="yes">yes</option>
            </select>
          </div>

          <div class="col-md-4">
            <label for="region" class="form-label">Region</label>
            <select id="region" class="form-select" required>
              <option value="southwest">southwest</option>
              <option value="southeast">southeast</option>
              <option value="northwest">northwest</option>
              <option value="northeast">northeast</option>
            </select>
          </div>

          <div class="col-12 mt-2">
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary" id="predict-btn">Predict</button>
              <button type="button" class="btn btn-outline-secondary" id="reset-btn">Reset</button>
              <div class="ms-auto small-muted align-self-center">Default API: <code>http://localhost:5000/predict</code></div>
            </div>
          </div>
        </form>

        <hr>

        <div id="feedback" style="display:none;">
          <div class="alert alert-info" id="status">Sending request...</div>
        </div>

        <div id="result-area" class="mt-3" style="display:none;">
          <div class="card border-0">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <div class="result-box" id="prediction-display">₹ 0.00</div>
                  <div class="small-muted">Predicted insurance charge</div>
                </div>
                <div class="col-md-4 text-md-end">
                  <button id="copy-btn" class="btn btn-sm btn-outline-primary">Copy value</button>
                </div>
              </div>

              <div class="mt-3 small-muted" id="raw-response" style="white-space:pre-wrap; display:none;"></div>
            </div>
          </div>
        </div>

        <div class="mt-3 small text-muted">
          <strong>Note:</strong> Adjust the `PREDICT_URL` variable in the script below if your backend runs on a different host/port or path.
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (for some UI niceties) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Change this if your API endpoint is different
    const PREDICT_URL = "http://localhost:5000/predict";

    const form = document.getElementById("predict-form");
    const statusBox = document.getElementById("status");
    const feedback = document.getElementById("feedback");
    const resultArea = document.getElementById("result-area");
    const predictionDisplay = document.getElementById("prediction-display");
    const rawResponse = document.getElementById("raw-response");
    const predictBtn = document.getElementById("predict-btn");
    const copyBtn = document.getElementById("copy-btn");
    const resetBtn = document.getElementById("reset-btn");

    function showStatus(text, type="info") {
      feedback.style.display = "block";
      statusBox.className = "alert alert-" + (type === "error" ? "danger" : type);
      statusBox.textContent = text;
    }

    function hideStatus() {
      feedback.style.display = "none";
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Disable button while request is running
      predictBtn.disabled = true;
      showStatus("Preparing request...", "info");
      resultArea.style.display = "none";

      // Gather values
      const payload = {
        age: Number(document.getElementById("age").value),
        sex: document.getElementById("sex").value,
        bmi: Number(document.getElementById("bmi").value),
        children: Number(document.getElementById("children").value),
        smoker: document.getElementById("smoker").value,
        region: document.getElementById("region").value
      };

      // Basic client-side validation
      if (isNaN(payload.age) || isNaN(payload.bmi) || isNaN(payload.children)) {
        showStatus("Please enter valid numeric values for Age, BMI and Children.", "error");
        predictBtn.disabled = false;
        return;
      }

      showStatus("Sending to backend...", "info");

      try {
        const resp = await fetch(PREDICT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) {
          const txt = await resp.text();
          showStatus("Server error: " + resp.status + " — " + txt, "error");
          predictBtn.disabled = false;
          return;
        }

        const data = await resp.json();

        if (data.prediction === undefined) {
          showStatus("Unexpected response from server. Expected JSON with key 'prediction'.", "error");
          rawResponse.style.display = "block";
          rawResponse.textContent = JSON.stringify(data, null, 2);
          predictBtn.disabled = false;
          return;
        }

        // Display nicely formatted prediction
        const predValue = Number(data.prediction);
        const formatted = predValue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        predictionDisplay.textContent = "₹ " + formatted;
        rawResponse.style.display = "none";
        resultArea.style.display = "block";
        hideStatus();
      } catch (err) {
        showStatus("Network or CORS error: " + err.message, "error");
      } finally {
        predictBtn.disabled = false;
      }
    });

    copyBtn.addEventListener("click", () => {
      const text = predictionDisplay.textContent;
      navigator.clipboard?.writeText(text).then(() => {
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy value", 1500);
      }).catch(() => {
        copyBtn.textContent = "Copy failed";
        setTimeout(() => copyBtn.textContent = "Copy value", 1500);
      });
    });

    resetBtn.addEventListener("click", () => {
      form.reset();
      // optional: set sensible defaults again
      document.getElementById("age").value = 19;
      document.getElementById("sex").value = "female";
      document.getElementById("bmi").value = 27.9;
      document.getElementById("children").value = 0;
      document.getElementById("smoker").value = "yes";
      document.getElementById("region").value = "southwest";
      resultArea.style.display = "none";
      hideStatus();
    });
  </script>
</body>
</html>
